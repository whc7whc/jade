<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å…¥ç‹€æ…‹æª¢æŸ¥</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .container { max-width: 800px; margin: 0 auto; }
        .status-box { padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .warning { background-color: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background-color: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; border-radius: 3px; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .test-actions { margin: 20px 0; }
        .test-actions button { background: #007bff; color: white; border: none; border-radius: 3px; }
        .test-actions button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” JADE è³¼ç‰©è»Šç™»å…¥ç‹€æ…‹æª¢æŸ¥å·¥å…·</h1>
        
        <div class="test-actions">
            <button onclick="checkLoginStatus()">ğŸ”„ é‡æ–°æª¢æŸ¥ç™»å…¥ç‹€æ…‹</button>
            <button onclick="simulateLogin()">ğŸ”‘ æ¨¡æ“¬ç™»å…¥</button>
            <button onclick="clearStorage()">ğŸ§¹ æ¸…é™¤ Storage</button>
            <button onclick="showAllStorage()">ğŸ“¦ é¡¯ç¤ºæ‰€æœ‰ Storage</button>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        function addResult(message, type = 'info', title = '') {
            const div = document.createElement('div');
            div.className = `status-box ${type}`;
            const titleText = title ? `<strong>${title}</strong><br>` : '';
            div.innerHTML = `${titleText}${message}`;
            document.getElementById('results').appendChild(div);
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        function checkLoginStatus() {
            clearResults();
            
            // æª¢æŸ¥å„ç¨®ç™»å…¥ç›¸é—œçš„ localStorage é …ç›®
            const authData = {
                memberId: localStorage.getItem('memberId'),
                authToken: localStorage.getItem('authToken'),
                auth_token: localStorage.getItem('auth_token'),
                token: localStorage.getItem('token'),
                currentUser: localStorage.getItem('currentUser'),
                user: localStorage.getItem('user'),
                isSeller: localStorage.getItem('isSeller'),
                isLogin: localStorage.getItem('isLogin')
            };
            
            addResult('é–‹å§‹æª¢æŸ¥ç™»å…¥ç‹€æ…‹...', 'info', 'ğŸ” ç™»å…¥ç‹€æ…‹æª¢æŸ¥');
            
            // æª¢æŸ¥ memberId
            if (authData.memberId && authData.memberId !== 'null' && authData.memberId !== '') {
                const parsedId = parseInt(authData.memberId, 10);
                if (!isNaN(parsedId) && parsedId > 0) {
                    addResult(`âœ… ç™¼ç¾æœ‰æ•ˆçš„æœƒå“¡ ID: ${parsedId}`, 'success', 'memberId æª¢æŸ¥');
                } else {
                    addResult(`âŒ memberId å­˜åœ¨ä½†ç„¡æ³•è§£æ: "${authData.memberId}"`, 'error', 'memberId æª¢æŸ¥');
                }
            } else {
                addResult(`âŒ æ²’æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„ memberId: "${authData.memberId}"`, 'error', 'memberId æª¢æŸ¥');
            }
            
            // æª¢æŸ¥ token
            const hasToken = !!(authData.authToken || authData.auth_token || authData.token);
            if (hasToken) {
                const tokenType = authData.authToken ? 'authToken' : (authData.auth_token ? 'auth_token' : 'token');
                addResult(`âœ… ç™¼ç¾èªè­‰ token (${tokenType})`, 'success', 'Token æª¢æŸ¥');
            } else {
                addResult('âŒ æ²’æœ‰æ‰¾åˆ°ä»»ä½•èªè­‰ token', 'error', 'Token æª¢æŸ¥');
            }
            
            // æª¢æŸ¥ currentUser
            if (authData.currentUser && authData.currentUser !== 'null') {
                try {
                    const userData = JSON.parse(authData.currentUser);
                    addResult(`âœ… ç™¼ç¾ç”¨æˆ¶è³‡æ–™: ${JSON.stringify(userData, null, 2)}`, 'success', 'currentUser æª¢æŸ¥');
                } catch (e) {
                    addResult(`âš ï¸ currentUser å­˜åœ¨ä½†ä¸æ˜¯æœ‰æ•ˆçš„ JSON: "${authData.currentUser}"`, 'warning', 'currentUser æª¢æŸ¥');
                }
            } else {
                addResult(`âŒ æ²’æœ‰æ‰¾åˆ° currentUser: "${authData.currentUser}"`, 'error', 'currentUser æª¢æŸ¥');
            }
            
            // è³¼ç‰©è»Šç™»å…¥æª¢æŸ¥é‚è¼¯
            const hasStandardAuth = !!(hasToken && authData.currentUser && authData.currentUser !== 'null');
            const hasMemberAuth = !!(authData.memberId && authData.memberId !== 'null' && authData.memberId !== '' && authData.memberId !== 'undefined');
            const isLoggedIn = hasStandardAuth || hasMemberAuth || !!authData.memberId;
            
            addResult(`
                <strong>æœ€çµ‚ç™»å…¥ç‹€æ…‹åˆ¤å®š:</strong><br>
                â€¢ æ¨™æº–èªè­‰: ${hasStandardAuth ? 'âœ…' : 'âŒ'}<br>
                â€¢ æœƒå“¡èªè­‰: ${hasMemberAuth ? 'âœ…' : 'âŒ'}<br>
                â€¢ æ•´é«”ç‹€æ…‹: ${isLoggedIn ? 'âœ… å·²ç™»å…¥' : 'âŒ æœªç™»å…¥'}
            `, isLoggedIn ? 'success' : 'error', 'ğŸ¯ æœ€çµ‚çµæœ');
            
            // é¡¯ç¤ºè©³ç´°è³‡æ–™
            const table = `
                <table>
                    <tr><th>é …ç›®</th><th>å€¼</th><th>ç‹€æ…‹</th></tr>
                    <tr><td>memberId</td><td>${authData.memberId || '(ç©º)'}</td><td>${authData.memberId ? 'âœ…' : 'âŒ'}</td></tr>
                    <tr><td>authToken</td><td>${authData.authToken ? '***éš±è—***' : '(ç©º)'}</td><td>${authData.authToken ? 'âœ…' : 'âŒ'}</td></tr>
                    <tr><td>auth_token</td><td>${authData.auth_token ? '***éš±è—***' : '(ç©º)'}</td><td>${authData.auth_token ? 'âœ…' : 'âŒ'}</td></tr>
                    <tr><td>token</td><td>${authData.token ? '***éš±è—***' : '(ç©º)'}</td><td>${authData.token ? 'âœ…' : 'âŒ'}</td></tr>
                    <tr><td>currentUser</td><td>${authData.currentUser ? '***éš±è—***' : '(ç©º)'}</td><td>${authData.currentUser ? 'âœ…' : 'âŒ'}</td></tr>
                    <tr><td>isSeller</td><td>${authData.isSeller || '(ç©º)'}</td><td>${authData.isSeller ? 'âœ…' : 'âŒ'}</td></tr>
                </table>
            `;
            
            addResult(table, 'info', 'ğŸ“‹ è©³ç´°è³‡æ–™');
        }
        
        function simulateLogin() {
            // æ¨¡æ“¬ç™»å…¥ï¼Œè¨­ç½®å¿…è¦çš„ localStorage é …ç›®
            localStorage.setItem('memberId', '123');
            localStorage.setItem('authToken', 'fake-token-12345');
            localStorage.setItem('currentUser', JSON.stringify({ id: 123, name: 'æ¸¬è©¦ç”¨æˆ¶', email: 'test@example.com' }));
            localStorage.setItem('isSeller', 'false');
            
            addResult('âœ… å·²æ¨¡æ“¬ç™»å…¥ç‹€æ…‹', 'success', 'ğŸ”‘ æ¨¡æ“¬ç™»å…¥');
            
            // é‡æ–°æª¢æŸ¥ç‹€æ…‹
            setTimeout(checkLoginStatus, 500);
        }
        
        function clearStorage() {
            const keysToRemove = ['memberId', 'authToken', 'auth_token', 'token', 'currentUser', 'user', 'isSeller', 'isLogin'];
            keysToRemove.forEach(key => localStorage.removeItem(key));
            
            addResult('ğŸ§¹ å·²æ¸…é™¤ç™»å…¥ç›¸é—œçš„ localStorage é …ç›®', 'warning', 'æ¸…é™¤ Storage');
            
            // é‡æ–°æª¢æŸ¥ç‹€æ…‹
            setTimeout(checkLoginStatus, 500);
        }
        
        function showAllStorage() {
            const allItems = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                allItems.push({ key, value: value.length > 100 ? value.substring(0, 100) + '...' : value });
            }
            
            if (allItems.length === 0) {
                addResult('localStorage æ˜¯ç©ºçš„', 'info', 'ğŸ“¦ æ‰€æœ‰ localStorage é …ç›®');
                return;
            }
            
            let table = '<table><tr><th>Key</th><th>Value</th></tr>';
            allItems.forEach(item => {
                table += `<tr><td>${item.key}</td><td>${item.value}</td></tr>`;
            });
            table += '</table>';
            
            addResult(table, 'info', 'ğŸ“¦ æ‰€æœ‰ localStorage é …ç›®');
        }
        
        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥
        window.onload = () => {
            addResult('é é¢è¼‰å…¥å®Œæˆï¼Œæ­£åœ¨æª¢æŸ¥ç™»å…¥ç‹€æ…‹...', 'info', 'ğŸš€ åˆå§‹åŒ–');
            checkLoginStatus();
        };
    </script>
</body>
</html>
